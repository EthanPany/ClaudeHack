# Dining Hall API Documentation

**Version:** 1.0.0
**Base URL:** `http://localhost:8000`

## Overview

The Dining Hall API provides endpoints for retrieving dining hall food items with AI-generated images. Built with FastAPI, it automatically generates professional food photography using DALL-E 3 for visualization.

## Table of Contents

- [Authentication](#authentication)
- [Endpoints](#endpoints)
  - [Status](#status)
  - [Foods](#foods)
  - [Admin](#admin)
  - [Images](#images)
- [Data Models](#data-models)
- [Error Handling](#error-handling)
- [Rate Limits](#rate-limits)

---

## Authentication

Currently, the API does not require authentication for read operations. All endpoints are publicly accessible.

---

## Endpoints

### Status

#### GET `/`

Get API status and health check information.

**Response:**
```json
{
  "message": "Dining Hall API",
  "total_items": 105
}
```

**Status Codes:**
- `200 OK` - Success

**Example:**
```bash
curl http://localhost:8000/
```

---

### Foods

#### GET `/api/foods`

Retrieve all food items with their details and image URLs.

**Response:** Array of [FoodItem](#fooditem) objects

**Status Codes:**
- `200 OK` - Success

**Example Request:**
```bash
curl http://localhost:8000/api/foods
```

**Example Response:**
```json
[
  {
    "id": "Sunrise Special Smoothie_Four Lakes Market",
    "name": "Sunrise Special Smoothie",
    "diningHall": "Four Lakes Market",
    "calories": 219,
    "image_url": "/images/sunrise_special_smoothie_four_lakes_market.png",
    "filename": "sunrise_special_smoothie_four_lakes_market.png"
  },
  {
    "id": "Pizza_North Campus Dining",
    "name": "Pizza",
    "diningHall": "North Campus Dining",
    "calories": 450,
    "image_url": "/images/pizza_north_campus_dining.png",
    "filename": "pizza_north_campus_dining.png"
  }
]
```

**Usage Notes:**
- Returns all available food items (currently ~105 items)
- Images are generated on first request if not already cached
- Use `image_url` to display images in your frontend

---

### Admin

#### GET `/api/reload`

Reload data from CSV and regenerate missing images.

**Use Cases:**
- After updating `dataset/nov19.csv`
- To regenerate images with new prompts
- Database refresh/reset

**Response:**
```json
{
  "message": "Data reloaded",
  "total_items": 105
}
```

**Status Codes:**
- `200 OK` - Success

**Example:**
```bash
curl http://localhost:8000/api/reload
```

**Process:**
1. Clears in-memory database
2. Reloads from `dataset/nov19.csv`
3. Generates images for items without existing images
4. Returns count of processed items

**Warning:** This operation may take time if many images need generation (DALL-E 3 API has rate limits).

---

### Images

#### GET `/images/{filename}`

Retrieve AI-generated food images.

**Parameters:**
- `filename` (path parameter) - The image filename (e.g., `sunrise_special_smoothie_four_lakes_market.png`)

**Response:** PNG image file (1024x1024px)

**Status Codes:**
- `200 OK` - Image found and returned
- `404 Not Found` - Image doesn't exist

**Example:**
```bash
curl http://localhost:8000/images/sunrise_special_smoothie_four_lakes_market.png --output smoothie.png
```

**Usage in HTML:**
```html
<img src="http://localhost:8000/images/sunrise_special_smoothie_four_lakes_market.png"
     alt="Sunrise Special Smoothie" />
```

**Image Details:**
- Format: PNG
- Size: 1024x1024 pixels
- Generated by: DALL-E 3
- Style: Professional food photography with natural lighting

---

## Data Models

### FoodItem

Represents a single food item with its metadata.

| Field | Type | Description | Example |
|-------|------|-------------|---------|
| `id` | string | Unique identifier (name_diningHall) | `"Pizza_North Campus Dining"` |
| `name` | string | Name of the food item | `"Pizza"` |
| `diningHall` | string | Which dining hall serves this item | `"North Campus Dining"` |
| `calories` | integer | Calorie count | `450` |
| `image_url` | string \| null | Relative URL to image or null if not generated | `"/images/pizza_north_campus_dining.png"` |
| `filename` | string \| null | Image filename or null if not generated | `"pizza_north_campus_dining.png"` |

**Example:**
```json
{
  "id": "Grilled Sesame Ginger Salmon_Four Lakes Market",
  "name": "Grilled Sesame Ginger Salmon",
  "diningHall": "Four Lakes Market",
  "calories": 409,
  "image_url": "/images/grilled_sesame_ginger_salmon_four_lakes_market.png",
  "filename": "grilled_sesame_ginger_salmon_four_lakes_market.png"
}
```

---

## Error Handling

The API uses standard HTTP status codes to indicate success or failure.

### Status Codes

| Code | Meaning | Description |
|------|---------|-------------|
| `200` | OK | Request successful |
| `404` | Not Found | Resource not found (e.g., image doesn't exist) |
| `422` | Unprocessable Entity | Validation error |
| `500` | Internal Server Error | Server error |

### Error Response Format

```json
{
  "detail": "Error message describing what went wrong"
}
```

**Example Error:**
```json
{
  "detail": "File not found"
}
```

---

## Rate Limits

**Current Implementation:**
- No rate limiting on API endpoints
- DALL-E 3 image generation is subject to OpenAI API rate limits
- Images are cached after first generation

**Recommendations:**
- Cache image URLs on the frontend
- Avoid calling `/api/reload` frequently
- Use `/api/foods` endpoint sparingly (consider caching for 5-10 minutes)

---

## Interactive Documentation

When the server is running, you can access interactive API documentation:

- **Swagger UI:** http://localhost:8000/docs
- **ReDoc:** http://localhost:8000/redoc

These provide:
- Interactive endpoint testing
- Request/response examples
- Schema validation
- Try-it-out functionality

---

## CORS Configuration

CORS is enabled for all origins (`*`) to facilitate frontend development.

**Allowed:**
- All origins
- All methods (GET, POST, PUT, DELETE, etc.)
- All headers

**Production Note:** Restrict CORS origins in production environments.

---

## Examples

### JavaScript/Fetch

```javascript
// Get all foods
fetch('http://localhost:8000/api/foods')
  .then(response => response.json())
  .then(data => {
    console.log(`Loaded ${data.length} food items`);
    data.forEach(food => {
      console.log(`${food.name} at ${food.diningHall}: ${food.calories} cal`);
    });
  });
```

### Python/Requests

```python
import requests

# Get all foods
response = requests.get('http://localhost:8000/api/foods')
foods = response.json()

for food in foods:
    print(f"{food['name']} - {food['diningHall']} ({food['calories']} cal)")
    print(f"  Image: {food['image_url']}")
```

### cURL

```bash
# Get server status
curl http://localhost:8000/

# Get all foods (pretty print)
curl http://localhost:8000/api/foods | python -m json.tool

# Reload data
curl http://localhost:8000/api/reload

# Download an image
curl http://localhost:8000/images/pizza_north_campus_dining.png -o pizza.png
```

---

## Support

For issues or questions:
- Check server logs for error messages
- Verify CSV format matches expected schema
- Ensure OpenAI API key is set correctly in `.env`
- Review [README.md](README.md) for setup instructions

---

**Last Updated:** 2025-11-19
**Maintained By:** Dining Hall API Team
